{"version":3,"file":"iframe-mitt.js","sources":["../src/child.js","../src/parent.js","../index.js"],"sourcesContent":["import mitt from 'mitt';\nconst emitter = mitt();\n\nexport default class {\n    static init () {\n        window.addEventListener('message', (e) => {\n            if (!e.data || !e.data.type) return;\n\n            const message = {\n                data: e.data.message,\n                origin: e.origin,\n                source: e.source\n            };\n            emitter.emit(e.data.type, message);\n        });\n\n        const message = {\n            type: 'iframe_mitt:ready',\n            data: 'ready'\n        };\n        this.postMessage(message, '*');\n\n    }\n    static postMessage (message, targetOrigin, transfer) {\n        if (window.parent) {\n            window.console.info(message, targetOrigin, transfer);\n            window.parent.postMessage(message, targetOrigin, transfer);\n        }\n    }\n    static emit (type, { message, targetOrigin, transfer }) {\n        const data = { type, message };\n        this.postMessage(data, targetOrigin, transfer);\n    }\n    static on (type, handler) {\n        emitter.on(type, handler);\n    }\n    static off (type, handler) {\n        emitter.off(type, handler);\n    }\n}\n","import mitt from 'mitt';\nconst emitter = mitt();\n\nconst Iframe = {\n    window: null,\n    callbacks: [],\n    ready (cb) {\n        return this.callbacks === null ? cb() : this.callbacks.push(cb);\n    }\n};\n\nexport default class {\n    /**\n     * 监听 iframe 消息，收到 iframe_mitt:ready 事件后即可向 iframe 发送消息\n     */\n    static init () {\n        window.addEventListener('message', (e) => {\n            if (!e.data || !e.data.type) return;\n\n            const type = e.data.type;\n            if (type === 'iframe_mitt:ready') {\n                Iframe.window = e.source;\n                if (Iframe.callbacks && Iframe.callbacks.length) {\n                    while (Iframe.callbacks.length) {\n                        Iframe.callbacks.shift()();\n                    }\n                }\n                Iframe.callbacks = null;\n            } else {\n                const message = {\n                    data: e.data.message,\n                    origin: e.origin,\n                    source: e.source\n                };\n                emitter.emit(e.data.type, message);\n            }\n        }, false);\n    }\n    static emit (type, { message, targetOrigin, transfer }) {\n        Iframe.ready(() => {\n            const data = { type, message };\n            window.console.info(data, targetOrigin, transfer);\n            return Iframe.window.postMessage(data, targetOrigin, transfer);\n        });\n    }\n    static on (type, handler) {\n        emitter.on(type, handler);\n    }\n    static off (type, handler) {\n        emitter.off(type, handler);\n    }\n}\n","import child from './src/child';\nimport parent from './src/parent';\n\nexport default {\n    child,\n    parent\n}; "],"names":["const","emitter","defaultExport","child","parent"],"mappings":"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"}